<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SCP Foundation DB - Вход</title>
  <style>
    body { background:#111; color:#eee; font-family:Arial; text-align:center; margin:0; }
    input,button { margin:5px; padding:8px; border-radius:5px; border:none; }
    button { background:#222; color:white; cursor:pointer; }
    button:hover { background:#444; }
    #authSection { margin-top:100px; background:#1a1a1a; padding:20px; border-radius:10px; display:inline-block; }
  </style>
</head>
<body>
  <h1>SCP Foundation Database</h1>

  <div id="authSection">
    <input type="text" id="nick" placeholder="Ник"><br>
    <input type="password" id="password" placeholder="Пароль"><br>
    <button onclick="register()">Регистрация</button>
    <button onclick="login()">Вход</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA7mvVHeOg48A8HZknsdidnZlKQV6BJLIo",
      authDomain: "scp-foundation-45b20.firebaseapp.com",
      databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com",
      projectId: "scp-foundation-45b20",
      storageBucket: "scp-foundation-45b20.appspot.com",
      messagingSenderId: "383272466518",
      appId: "1:383272466518:web:3225b8911a56c9d769e3f7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    function roleByLevel(level){
      switch(Number(level)){
        case 5: return "O5";
        case 4: return "Администратор";
        case 3: return "Исследователь";
        case 2: return "Охрана";
        default: return "Персонал D";
      }
    }

    async function register() {
      const nick = document.getElementById("nick").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!nick || !password) return alert("Введите ник и пароль!");

      // по умолчанию: Level 1, роль "Исследователь"
      await set(ref(db, "users/" + nick), { password, level: 1, role: "Исследователь" });
      alert("Регистрация успешна!");
    }

    async function login() {
      const nick = document.getElementById("nick").value.trim();
      const password = document.getElementById("password").value.trim();

      const snap = await get(child(ref(db), "users/" + nick));
      if (!snap.exists()) return alert("Нет такого пользователя!");
      const data = snap.val();
      if (data.password !== password) return alert("Неверный пароль!");

      const level = Number(data.level || 1);
      const role = data.role || roleByLevel(level);

      localStorage.setItem("nick", nick);
      localStorage.setItem("level", String(level));
      localStorage.setItem("role", role);

      window.location.href = "home.html";
    }

    window.register = register;
    window.login = login;
  </script>
</body>
</html>
