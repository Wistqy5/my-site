<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Вход | SCP Foundation</title>
  <style>
    body {
      background:#0d0d0d;
      color:#eee;
      font-family:Segoe UI, Arial, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      margin:0;
    }
    .box {
      width:300px; /* стало уже */
      background:#111;
      border-radius:12px;
      padding:22px;
      box-shadow:0 8px 28px rgba(0,0,0,.55);
    }
    h2 {
      margin:0 0 8px;
      font-weight:600;
      font-size:18px;
      display:flex;
      align-items:center;
    }
    #logo {
      width:22px;
      height:22px;
      margin-right:6px;
    }
    .muted {
      color:#aaa;
      font-size:13px;
      margin-bottom:16px;
    }

    /* Tabs */
    .tabs {
      display:flex;
      margin-bottom:14px;
      border-radius:6px;
      overflow:hidden;
    }
    .tab {
      flex:1;
      text-align:center;
      padding:8px 0;
      font-size:14px;
      cursor:pointer;
      background:#222;
      transition:.3s;
    }
    .tab.active {
      background:#c62828;
    }

    label {
      font-size:13px;
      color:#bbb;
      display:block;
      margin-bottom:4px;
    }
    input {
      width:90%;
      padding:10px;
      margin-bottom:14px;
      border:1px solid #333;
      border-radius:8px;
      background:#000;
      color:#eee;
      font-size:14px;
    }

    button {
      width:100%;
      padding:12px;
      border:0;
      border-radius:8px;
      cursor:pointer;
      font-weight:600;
      background:#c62828;
      color:#fff;
      font-size:15px;
      transition:.3s;
    }
    button:hover { background:#e53935; }

    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="box">
    <h2><img id="logo" src="logo.png" alt="">SCP Foundation</h2>
    <div class="muted">Доступ только для авторизованного персонала Фонда.</div>

    <div class="tabs">
      <div id="tab-login" class="tab active" onclick="switchTab('login')">Войти</div>
      <div id="tab-reg" class="tab" onclick="switchTab('reg')">Регистрация</div>
    </div>

    <!-- Вход -->
    <div id="form-login">
      <label>Ник</label>
      <input id="loginNick" type="text" placeholder="Ник">
      <label>Пароль</label>
      <input id="loginPass" type="password" placeholder="Пароль">
      <button onclick="login()">Войти</button>
    </div>

    <!-- Регистрация -->
    <div id="form-reg" class="hidden">
      <label>Ник</label>
      <input id="regNick" type="text" placeholder="Придумайте ник">
      <label>Пароль</label>
      <input id="regPass" type="password" placeholder="Минимум 4 символа">
      <button onclick="register()">Зарегистрироваться</button>
      <div class="muted" style="margin-top:8px;">
        Будут назначены: Уровень 0, Роль Класс-Д.
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA7mvVHeOg48A8HZknsdidnZlKQV6BJLIo",
      authDomain: "scp-foundation-45b20.firebaseapp.com",
      databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com/",
      projectId: "scp-foundation-45b20",
      storageBucket: "scp-foundation-45b20.appspot.com",
      messagingSenderId: "383272466518",
      appId: "1:383272466518:web:3225b8911a56c9d769e3f7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.switchTab = (name) => {
      document.getElementById('form-login').classList.toggle('hidden', name !== 'login');
      document.getElementById('form-reg').classList.toggle('hidden', name !== 'reg');
      document.getElementById('tab-login').classList.toggle('active', name === 'login');
      document.getElementById('tab-reg').classList.toggle('active', name === 'reg');
    };

    window.login = async () => {
      const nick = document.getElementById("loginNick").value.trim();
      const pass = document.getElementById("loginPass").value.trim();
      if (!nick || !pass) return alert("Введите ник и пароль");

      const snap = await get(ref(db, "users/" + nick));
      if (!snap.exists()) return alert("Пиздабол");
      const user = snap.val();
      if (user.password !== pass) return alert("Неверный пароль");

      localStorage.setItem("user", JSON.stringify({ nick, level: user.level || 0, role: user.role || "Class-D" }));
      window.location.href = "home.html";
    };

    window.register = async () => {
      const nick = document.getElementById("regNick").value.trim();
      const pass = document.getElementById("regPass").value.trim();
      if (nick.length < 3) return alert("Ник минимум 3 символа");
      if (pass.length < 4) return alert("Пароль минимум 4 символа");

      const path = ref(db, "users/" + nick);
      const exists = (await get(path)).exists();
      if (exists) return alert("Такой ник уже занят");

      const newUser = { password: pass, level: 0, role: "Class-D", createdAt: Date.now() };
      await set(path, newUser);
      localStorage.setItem("user", JSON.stringify({ nick, level: 0, role: "Class-D" }));
      window.location.href = "home.html";
    };
  </script>
</body>
</html>
