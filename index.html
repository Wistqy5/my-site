<script>
    let users = [];
    let currentUser = null;

    let scpData = [
        { id: "SCP-096", level: 4, class: "–ï–≤–∫–ª–∏–¥", description: "–°—É—â–µ—Å—Ç–≤–æ, –≤–ø–∞–¥–∞—é—â–µ–µ –≤ —è—Ä–æ—Å—Ç—å –ø—Ä–∏ –≤–∑–≥–ª—è–¥–µ –Ω–∞ –ª–∏—Ü–æ." },
        { id: "SCP-173", level: 2, class: "–ï–≤–∫–ª–∏–¥", description: "–°—Ç–∞—Ç—É—è, —Å–ø–æ—Å–æ–±–Ω–∞—è –¥–≤–∏–≥–∞—Ç—å—Å—è, –∫–æ–≥–¥–∞ –µ—ë –Ω–µ –≤–∏–¥—è—Ç." },
        { id: "SCP-682", level: 5, class: "–ö–µ—Ç–µ—Ä", description: "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—É–Ω–∏—á—Ç–æ–∂–∞–µ–º–æ–µ —Å—É—â–µ—Å—Ç–≤–æ." }
    ];

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ localStorage –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    function loadUsers() {
        const saved = localStorage.getItem("scpUsers");
        if (saved) {
            users = JSON.parse(saved);
        } else {
            users = [
                { username: "admin", password: "1234", role: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä", level: 5 },
                { username: "bright", password: "scp", role: "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", level: 3 }
            ];
            saveUsers();
        }
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ localStorage
    function saveUsers() {
        localStorage.setItem("scpUsers", JSON.stringify(users));
    }

    function showRegisterForm() {
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("register").classList.remove("hidden");
}

// –°–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
function hideRegisterForm() {
    document.getElementById("register").classList.add("hidden");
    document.getElementById("auth").classList.remove("hidden");
}

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    function login() {
        const name = document.getElementById("login-name").value.trim();
        const pass = document.getElementById("login-pass").value.trim();
        const user = users.find(u => u.username === name && u.password === pass);
        if (!user) return alert("–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ");
        currentUser = user;
        document.getElementById("auth").classList.add("hidden");
        document.getElementById("main").classList.remove("hidden");
        document.getElementById("profile").innerHTML = `<strong>–ü—Ä–æ—Ñ–∏–ª—å:</strong> ${user.username} | –£—Ä–æ–≤–µ–Ω—å: ${user.level} | –†–æ–ª—å: ${user.role}`;
        if (user.role === "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä") document.getElementById("admin-panel").classList.remove("hidden");
        renderSCPList();
    }

    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    function register() {
        const username = document.getElementById("register-name").value.trim();
        const password = document.getElementById("register-pass").value.trim();
        const passwordConfirm = document.getElementById("register-pass-confirm").value.trim();

        if (!username || !password || password !== passwordConfirm) {
            return alert("‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç.");
        }

        if (users.some(u => u.username === username)) {
            return alert("–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.");
        }

        users.push({ username, password, role: "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", level: 1 });
        saveUsers();
        alert("‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
        hideRegisterForm();
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ SCP
    function createSCP() {
        if (currentUser.level < 3) return alert("‚õî –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è SCP.");
        const id = document.getElementById("new-id").value.trim();
        const level = parseInt(document.getElementById("new-level").value);
        const cls = document.getElementById("new-class").value.trim();
        const desc = document.getElementById("new-desc").value.trim();
        if (!id || !cls || !desc || isNaN(level)) return alert("‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è.");
        if (level > 5) return alert("üö´ –£—Ä–æ–≤–µ–Ω—å –¥–æ–ø—É—Å–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—à–µ 5.");
        scpData.push({ id, level, class: cls, description: desc });
        renderSCPList();
        alert("‚úÖ SCP —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!");
    }

    // –í—ã–¥–∞—á–∞ —Ä–æ–ª–∏
    function assignRole() {
        if (!currentUser || currentUser.role !== "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä") {
            return alert("‚õî –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—ã–¥–∞–≤–∞—Ç—å —Ä–æ–ª–∏.");
        }

        const targetName = document.getElementById("target-user").value.trim();
        const targetRole = document.getElementById("target-role").value;

        const targetUser = users.find(u => u.username === targetName);
        if (!targetUser) return alert("üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.");

        targetUser.role = targetRole;
        if (targetRole === "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å") {
            targetUser.level = 2;
        } else if (targetRole === "–û5") {
            targetUser.level = 5;
        }

        saveUsers();
        alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${targetUser.username} –≤—ã–¥–∞–Ω–∞ —Ä–æ–ª—å: ${targetUser.role} (—É—Ä–æ–≤–µ–Ω—å ${targetUser.level})`);

        if (currentUser.username === targetUser.username) {
            document.getElementById("profile").innerHTML =
                `<strong>–ü—Ä–æ—Ñ–∏–ª—å:</strong> ${currentUser.username} | –£—Ä–æ–≤–µ–Ω—å: ${currentUser.level} | –†–æ–ª—å: ${currentUser.role}`;
        }
    }

    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ SCP
    function renderSCPList() {
        const query = document.getElementById("search").value.toLowerCase();
        const list = document.getElementById("scp-list");
        list.innerHTML = "";
        scpData.filter(scp => scp.id.toLowerCase().includes(query)).forEach(scp => {
            const link = document.createElement("a");
            link.className = "scp-link";
            link.href = "#";
            link.textContent = scp.id;
            link.onclick = () => openSCP(scp);
            list.appendChild(link);
        });
    }

    // –û—Ç–∫—Ä—ã—Ç—å SCP
    function openSCP(scp) {
        if (currentUser.level < scp.level) {
            alert("‚õî Access Denied: –£—Ä–æ–≤–µ–Ω—å –¥–æ–ø—É—Å–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω.");
            return;
        }
        const modal = document.getElementById("scp-modal");
        modal.innerHTML = `<h2>${scp.id}</h2><p><strong>–ö–ª–∞—Å—Å:</strong> ${scp.class}</p><p>${scp.description}</p><button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>`;
        document.getElementById("overlay").style.display = "block";
        modal.style.display = "block";
    }

    function closeModal() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("scp-modal").style.display = "none";
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
    window.onload = loadUsers;
</script>
