<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SCP Foundation Intranet</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  
  <style>
  body {
    background: #0a0a0a;
    color: #f0f0f0;
    font-family: "Segoe UI", Arial, sans-serif;
    display: flex;
    height: 100vh;
    margin: 0;
  }

  /* ==== Sidebar ==== */
  #sidebar {
    width: 280px;
    background: #121212;
    padding: 20px;
    border-right: 2px solid #1e1e1e;
    overflow-y: auto;
    box-shadow: 4px 0 12px rgba(0,0,0,0.5);
  }
  #sidebar h3 {
    margin: 0 0 12px;
    font-size: 18px;
    font-weight: 600;
    padding-bottom: 10px;
    border-bottom: 1px solid #2a2a2a;
    color: #f5f5f5;
  }
  .scp-entry {
    display: block;
    padding: 10px 12px;
    margin: 6px 0;
    border-radius: 8px;
    color: #ccc;
    text-decoration: none;
    transition: all 0.2s ease-in-out;
  }
  .scp-entry:hover {
    background: #1f1f1f;
    color: #fff;
    transform: translateX(4px);
  }

  /* ==== Content ==== */
  #content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
  }
  h1 {
    margin: 0 0 20px;
    font-size: 28px;
    font-weight: 700;
    color: #fafafa;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  /* ==== Cards / Panels ==== */
  #userInfo,
  .panel {
    background: #181818;
    padding: 20px;
    border-radius: 14px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    margin-bottom: 24px;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  #userInfo:hover,
  .panel:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 22px rgba(0,0,0,0.6);
  }

  /* ==== Form elements ==== */
  input,
  select,
  textarea {
    width: 100%;
    padding: 12px;
    margin: 8px 0 14px;
    border: 1px solid #2a2a2a;
    border-radius: 10px;
    background: #111;
    color: #eee;
    font-size: 14px;
    transition: border 0.2s;
  }
  input:focus,
  select:focus,
  textarea:focus {
    border-color: #e53935;
    outline: none;
  }

  /* ==== Buttons ==== */
  button {
    width: 100%;
    padding: 12px;
    border: 0;
    border-radius: 10px;
    background: linear-gradient(135deg, #c62828, #e53935);
    color: white;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(229,57,53,0.5);
  }
  #logoutBtn {
    background: linear-gradient(135deg, #444, #666);
  }
  #logoutBtn:hover {
    box-shadow: 0 4px 12px rgba(160,160,160,0.3);
  }

  /* ==== Logo ==== */
  #logo {
    width: 32px;
    height: 32px;
    vertical-align: middle;
    border-radius: 4px;
  }

  /* ==== Stats ==== */
  #userStats {
    background: #111;
    padding: 14px;
    border-radius: 10px;
    margin-top: 12px;
    font-size: 14px;
    line-height: 1.6;
    color: #ddd;
  }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar">
    <h3>База SCP</h3>
    <input type="text" id="search" placeholder="Поиск...">
    <div id="entries">Загрузка…</div>
  </div>

  <!-- Main content -->
  <div id="content">
    <h1><img id="logo" src="logo.png" alt="">SCP Foundation</h1>
    <div id="userInfo"></div>
    <button id="logoutBtn" onclick="logout()">Выйти</button>

    <!-- Admin -->
    <div id="adminPanel" class="panel" style="display:none;">
      <h3>Административная панель</h3>
      <input type="text" id="targetNick" placeholder="Ник пользователя">
      <label>Новый уровень:</label>
      <select id="newLevel"></select>
      <label>Роль:</label>
      <select id="newRole"></select>
      <div id="unitDiv" style="display:none;">
        <label>Подразделение:</label>
        <select id="newUnit"></select>
      </div>
      <label>Сайт:</label>
      <select id="newSite">
        <option>Site-01</option><option>Site-17</option><option>Site-19</option><option>Site-82</option><option>Site-██</option>
      </select>
      <button onclick="updateUser()">Обновить</button>
    </div>

    <!-- Stats -->
    <div id="statsPanel" class="panel" style="display:none;">
      <h3>Просмотр статистики</h3>
      <input type="text" id="statsNick" placeholder="Ник пользователя">
      <button onclick="showStats()">Показать</button>
      <div id="userStats"></div>
    </div>

    <!-- Add SCP -->
    <div id="addScpPanel" class="panel" style="display:none;">
      <h3>Добавить SCP-запись</h3>
      <input type="text" id="scpTitle" placeholder="Название SCP">
      <input type="number" id="scpLevel" placeholder="Требуемый уровень">
      <textarea id="scpContent" placeholder="Описание"></textarea>
      <button onclick="addScp()">Добавить</button>
    </div>
  </div>

<script>
  // === Firebase init ===
  const firebaseConfig = {
    apiKey: "AIzaSyA7mvVHeOg48A8HZknsdidnЗlKQV6BJLIo",
    authDomain: "scp-foundation-45b20.firebaseapp.com",
    databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com/",
    projectId: "scp-foundation-45b20",
    storageBucket: "scp-foundation-45b20.appspot.com",
    messagingSenderId: "383272466518",
    appId: "1:383272466518:web:3225b8911a56c9d769e3f7"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  const LEVELS = ["none","0","-1","1","1+","2","2+","3","3+","4","4+","5","5+","6","7"];
  const ROLES = [
    "Класс-Д","Группа Быстрого Реагирования","Медицинский Департамент",
    "Служба Разведки","Инжинерно-Техническая Служба","Отдел Внешних Связей",
    "Служба Внутреннего Трибунала","Комитет по Этике","Отдел Внутренней Безопасности",
    "Научный Департамент Специализированных Исследований","Служба Безопасности",
    "Мобильные Оперативные Группы","Административный Департамент",
    "Член Совета O5","The Administrator","Office of The Administrator"
  ];
  const UNITS = {
    "Научный Департамент Специализированных Исследований":["Jr Researcher","Researcher","Sr Researcher","Head Researcher"],
    "Служба Безопасности":["Cadet","Guard","Sr Guard","Captain"],
    "Мобильные Оперативные Группы":["Operative","Specialist","Commander"],
    "Член Совета O5":["O5-1","O5-2","O5-3","O5-4","O5-5","O5-6","O5-7","O5-8","O5-9","O5-10","O5-11","O5-12","O5-13"]
  };

  let currentUserData=null;

  // === Auth check ===
  auth.onAuthStateChanged(user=>{
    if(!user){location.href="index.html";return;}
    db.ref("users/"+user.uid).once("value").then(snap=>{
      currentUserData=snap.val();
      renderUserInfo();
      renderEntries();
      setupPanels();
    });
  });

  function renderUserInfo(){
    document.getElementById("userInfo").innerHTML=`
      <b>Ник:</b> ${currentUserData.nick}<br>
      <b>Уровень:</b> ${currentUserData.level}<br>
      <b>Роль:</b> ${currentUserData.role}<br>
      <b>Подразделение:</b> ${currentUserData.unit||"-"}<br>
      <b>Сайт:</b> ${currentUserData.site||"-"}
    `;
  }

  function setupPanels(){
    LEVELS.forEach(l=>{
      let o=document.createElement("option");
      o.value=l;o.text=l;
      document.getElementById("newLevel").appendChild(o);
    });
    ROLES.forEach(r=>{
      let o=document.createElement("option");
      o.value=r;o.text=r;
      document.getElementById("newRole").appendChild(o);
    });
    document.getElementById("newRole").addEventListener("change",()=>{
      let role=document.getElementById("newRole").value;
      let unitDiv=document.getElementById("unitDiv");
      let unitSel=document.getElementById("newUnit");
      unitSel.innerHTML="";
      if(UNITS[role]){
        UNITS[role].forEach(u=>{
          let o=document.createElement("option");
          o.value=u;o.text=u;
          unitSel.appendChild(o);
        });
        unitDiv.style.display="block";
      } else unitDiv.style.display="none";
    });

    if(["6","7"].includes(currentUserData.level)) 
      document.getElementById("adminPanel").style.display="block";
    if(parseInt(currentUserData.level)>=4) 
      document.getElementById("statsPanel").style.display="block";
    if(["6","7"].includes(currentUserData.level)) 
      document.getElementById("addScpPanel").style.display="block";
  }

  function renderEntries(){
    db.ref("scp").on("value",snap=>{
      let list=document.getElementById("entries");
      list.innerHTML="";
      snap.forEach(s=>{
        let e=s.val();
        if(parseInt(currentUserData.level)>=parseInt(e.level)){
          let a=document.createElement("a");
          a.className="scp-entry";
          a.textContent=e.title;
          a.href="#";
          a.onclick=()=>alert("["+e.title+"]\n"+e.content);
          list.appendChild(a);
        }
      });
    });
  }

  function addScp(){
    let title=document.getElementById("scpTitle").value;
    let level=document.getElementById("scpLevel").value;
    let content=document.getElementById("scpContent").value;
    if(!title||!content) return alert("Заполните поля");
    db.ref("scp").push({title,level,content});
    alert("Добавлено!");
  }

  function updateUser(){
    let nick=document.getElementById("targetNick").value;
    if(!nick) return alert("Введите ник");
    db.ref("users").orderByChild("nick").equalTo(nick).once("value",snap=>{
      if(!snap.exists()) return alert("Нет такого пользователя");
      snap.forEach(u=>{
        let updates={
          level:document.getElementById("newLevel").value,
          role:document.getElementById("newRole").value,
          site:document.getElementById("newSite").value
        };
        if(UNITS[updates.role]) 
          updates.unit=document.getElementById("newUnit").value;
        db.ref("users/"+u.key).update(updates);
        alert("Обновлено!");
      });
    });
  }

  function showStats(){
    let nick=document.getElementById("statsNick").value;
    db.ref("users").orderByChild("nick").equalTo(nick).once("value",snap=>{
      if(!snap.exists()) return alert("Нет такого");
      snap.forEach(u=>{
        let d=u.val();
        document.getElementById("userStats").innerHTML=`
          <b>Ник:</b> ${d.nick}<br>
          <b>Уровень:</b> ${d.level}<br>
          <b>Роль:</b> ${d.role}<br>
          <b>Подразделение:</b> ${d.unit||"-"}<br>
          <b>Сайт:</b> ${d.site||"-"}
        `;
      });
    });
  }

  function logout(){auth.signOut();}
  window.addScp=addScp;
  window.updateUser=updateUser;
  window.showStats=showStats;
  window.logout=logout;
</script>
</body>
</html>
