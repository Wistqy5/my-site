<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SCP Foundation</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#111; color:white; display:flex; height:100vh; }
    #sidebar { width:250px; background:#1a1a1a; padding:15px; }
    #main { flex:1; padding:20px; }
    input, textarea, select, button { margin:5px 0; padding:8px; width:100%; }
    button { cursor:pointer; background:#333; color:white; border:none; }
    .scp-entry { border:1px solid #444; padding:10px; margin:10px 0; }
    .hidden { display:none; }
    h2, h3 { margin-top:0; }
  </style>
</head>
<body>
  <!-- –õ–µ–≤–æ–µ –º–µ–Ω—é -->
  <div id="sidebar">
    <h3>–ü–æ–∏—Å–∫ SCP</h3>
    <input type="text" id="searchBox" placeholder="–ü–æ–∏—Å–∫...">
    <div id="scpList">–ù–µ—Ç SCP –∑–∞–ø–∏—Å–µ–π</div>
  </div>

  <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å -->
  <div id="main">
    <h2>‚òâ SCP Foundation</h2>
    <p id="helloNick"></p>
    <p id="userInfo"></p>
    <button onclick="logout()">–í—ã—Ö–æ–¥</button>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ SCP (–≤–∏–¥–Ω–æ —Å Level ‚â• 3) -->
    <div id="createSCP" class="hidden">
      <h3>–°–æ–∑–¥–∞—Ç—å SCP</h3>
      <input type="text" id="scpTitle" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ SCP">
      <textarea id="scpDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ SCP"></textarea>
      <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</label>
      <select id="scpLevel">
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <option value="3">Level 3</option>
        <option value="4">Level 4</option>
        <option value="5">Level 5</option>
      </select>
      <button onclick="addSCP()">–î–æ–±–∞–≤–∏—Ç—å SCP</button>
    </div>

    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–≤–∏–¥–Ω–æ —Å Level ‚â• 4) -->
    <div id="adminPanel" class="hidden">
      <h3>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å</h3>
      <input type="text" id="targetNick" placeholder="–ù–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"><br>
      <label>–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å:</label>
      <select id="newLevel">
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <option value="3">Level 3</option>
        <option value="4">Level 4</option>
        <option value="5">Level 5</option>
      </select><br>
      <label>–†–æ–ª—å:</label>
      <select id="newRole">
        <option value="Researcher">Researcher</option>
        <option value="Security">Security</option>
        <option value="MTF">MTF</option>
        <option value="Administrator">Administrator</option>
        <option value="O5">O5 Council</option>
      </select><br>
      <button onclick="updateUser()">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
  </div>

  <script>
    // üîπ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDMyRGsc3e6TdpsmJRR2k9m8WgytZgA2kA",
      authDomain: "scp-foundation-45b20.firebaseapp.com",
      databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com",
      projectId: "scp-foundation-45b20",
      storageBucket: "scp-foundation-45b20.appspot.com",
      messagingSenderId: "1004419753862",
      appId: "1:1004419753862:web:0fb54cf65f28ef35d546db"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = null, userLevel = 0, userRole = "";

    // üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    window.onload = function() {
      const userData = JSON.parse(localStorage.getItem("user"));
      if (!userData) {
        window.location.href = "index.html"; // –µ—Å–ª–∏ –Ω–µ –≤–æ—à—ë–ª ‚Üí –Ω–∞ login
      } else {
        currentUser = userData.nick;
        userLevel = userData.level;
        userRole = userData.role;

        document.getElementById("helloNick").textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser}!`;
        document.getElementById("userInfo").textContent = `–í–∞—à —É—Ä–æ–≤–µ–Ω—å: ${userLevel} | –í–∞—à–∞ —Ä–æ–ª—å: ${userRole}`;

        if (userLevel >= 3) document.getElementById("createSCP").classList.remove("hidden");
        if (userLevel >= 4) document.getElementById("adminPanel").classList.remove("hidden");

        loadEntries();
      }
    };

    // üîπ –î–æ–±–∞–≤–∏—Ç—å SCP
    function addSCP() {
      const title = document.getElementById("scpTitle").value.trim();
      const desc = document.getElementById("scpDesc").value.trim();
      const level = parseInt(document.getElementById("scpLevel").value);

      if (!title || !desc) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");

      const id = "scp_" + Date.now();
      db.ref("scp/" + id).set({
        title, desc, level,
        author: currentUser
      });
      alert("SCP –¥–æ–±–∞–≤–ª–µ–Ω!");
      loadEntries();
    }

    // üîπ –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function updateUser() {
      const nick = document.getElementById("targetNick").value.trim();
      const newLevel = parseInt(document.getElementById("newLevel").value);
      const newRole = document.getElementById("newRole").value;

      if (!nick) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
      db.ref("users/" + nick).update({ level:newLevel, role:newRole });
      alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—ë–Ω!");
    }

    // üîπ –ó–∞–≥—Ä—É–∑–∏—Ç—å SCP
    function loadEntries() {
      const list = document.getElementById("scpList");
      db.ref("scp").on("value", snap => {
        list.innerHTML = "";
        if (!snap.exists()) { list.innerHTML = "–ù–µ—Ç SCP –∑–∞–ø–∏—Å–µ–π"; return; }

        snap.forEach(child => {
          const scp = child.val();
          if (scp.level <= userLevel) {
            const div = document.createElement("div");
            div.className = "scp-entry";
            div.innerHTML = `<b>${scp.title}</b><br>${scp.desc}<br><small>–ê–≤—Ç–æ—Ä: ${scp.author} | –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞: ${scp.level}</small>`;
            list.appendChild(div);
          }
        });
      });
    }

    // üîπ –í—ã—Ö–æ–¥
    function logout() {
      localStorage.removeItem("user");
      window.location.href = "index.html";
    }

    // üîπ –ü–æ–∏—Å–∫
    document.getElementById("searchBox").addEventListener("input", function() {
      const search = this.value.toLowerCase();
      document.querySelectorAll(".scp-entry").forEach(div => {
        div.style.display = div.textContent.toLowerCase().includes(search) ? "block" : "none";
      });
    });
  </script>
</body>
</html>
