<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>SCP Foundation Intranet</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    body {
      background:#0d0d0d;
      color:#f5f5f5;
      font-family:Segoe UI, Arial, sans-serif;
      margin:0;
      display:flex;
      justify-content:center;
    }
    #container {
      width:100%;
      max-width:1000px;
      padding:20px;
    }
    h1 { font-size:26px; color:#e0e0e0; }
    .panel {
      background:#1c1c1c;
      padding:18px;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,.4);
      margin-bottom:22px;
    }
    input, select, textarea {
      width:100%;
      padding:10px;
      margin:8px 0;
      border:1px solid #333;
      border-radius:8px;
      background:#111;
      color:#eee;
    }
    input:focus, select:focus, textarea:focus {
      border-color:#c62828;
      outline:none;
    }
    button {
      width:100%;
      padding:10px;
      border:0;
      border-radius:8px;
      background:#c62828;
      color:white;
      font-weight:600;
      cursor:pointer;
      margin-top:10px;
    }
    button:hover { background:#e53935; }
    #logoutBtn { background:#444; }
    #logoutBtn:hover { background:#666; }
    input[type="checkbox"] {
      accent-color:#f05454;
      transform:scale(1.2);
      margin-right:6px;
    }
    #userStats {
      background:#111;
      padding:12px;
      border-radius:8px;
      margin-top:10px;
      font-size:14px;
      line-height:1.6;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>SCP Foundation</h1>

    <div id="userInfo" class="panel">
      <p><b>Добро пожаловать, <span id="nickname"></span>!</b></p>
      <p>Ваш уровень: <span id="level"></span></p>
      <p>Ваша роль: <span id="role"></span></p>
      <p>Ваш сайт: <span id="site"></span></p>
      <button id="logoutBtn">Выйти</button>
    </div>

    <!-- Админ-панель -->
    <div id="adminPanel" class="panel" style="display:none;">
      <h3>Административная панель</h3>
      <input type="text" id="targetNick" placeholder="Ник пользователя">

      <label>Новый уровень:</label>
      <select id="newLevel">
        <option value="none">Level none</option>
        <option value="0">Level 0</option>
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <option value="3">Level 3</option>
        <option value="4">Level 4</option>
        <option value="5">Level 5</option>
        <option value="6">Level Omni</option>
        <option value="7">Level Omni+</option>
      </select>

      <label>Роль:</label>
      <select id="newRole">
        <option value="Класс-Д">Класс-Д</option>
        <option value="Научный сотрудник">Научный сотрудник</option>
        <option value="Охрана">Охрана</option>
        <option value="Член Совета O5">Член Совета O5</option>
      </select>

      <div id="unitDiv" style="display:none;">
        <label id="unitLabel">Подразделение:</label>
        <select id="newUnit"></select>
      </div>

      <label>Сайт:</label>
      <select id="newSite">
        <option value="Site-01">Site-01</option>
        <option value="Site-19">Site-19</option>
        <option value="Site-77">Site-77</option>
      </select>

      <!-- Чекбоксы -->
      <div style="margin-top:12px;">
        <label><input type="checkbox" id="isTrial"> Испытательный срок</label><br>
        <label id="adminCheckboxWrapper" style="display:none;">
          <input type="checkbox" id="isAdmin"> Дать доступ к админ-панели
        </label>
      </div>

      <button onclick="updateUser()">Обновить</button>
    </div>

    <!-- Просмотр статистики -->
    <div class="panel">
      <h3>Просмотр статистики пользователя</h3>
      <input type="text" id="statsNick" placeholder="Ник пользователя">
      <button onclick="showStats()">Показать статистику</button>
      <div id="userStats"></div>
    </div>
  </div>

<script type="module">
  // Firebase init
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
      apiKey: "AIzaSyA7mvVHeOg48A8HZknsdidnЗlKQV6BJLIo",
      authDomain: "scp-foundation-45b20.firebaseapp.com",
      databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com/",
      projectId: "scp-foundation-45b20",
      storageBucket: "scp-foundation-45b20.appspot.com",
      messagingSenderId: "383272466518",
      appId: "1:383272466518:web:3225b8911a56c9d769e3f7"
    };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Показ чекбокса "Админ"
  document.getElementById("newLevel").addEventListener("change", () => {
    const val = parseInt(document.getElementById("newLevel").value);
    const adminWrapper = document.getElementById("adminCheckboxWrapper");
    if (val >= 6) {
      adminWrapper.style.display = "block";
    } else {
      adminWrapper.style.display = "none";
      document.getElementById("isAdmin").checked = false;
    }
  });

  // Обновление пользователя
  window.updateUser = async () => {
    const nick = document.getElementById("targetNick").value.trim();
    const levelVal = document.getElementById("newLevel").value;
    const level = levelVal === "none" ? "none" : parseInt(levelVal);
    const role = document.getElementById("newRole").value;
    const site = document.getElementById("newSite").value;
    const isTrial = document.getElementById("isTrial").checked;
    const isAdmin = document.getElementById("isAdmin").checked;

    if (!nick) return alert("Введите ник пользователя");

    const uref = ref(db, "users/" + nick);
    const snap = await get(uref);
    if (!snap.exists()) return alert("Пользователь не найден");

    await update(uref, { level, role, site, isTrial, isAdmin });
    alert(`Пользователь ${nick} обновлён!`);
  };

  // Просмотр статистики
  window.showStats = async () => {
    const nick = document.getElementById("statsNick").value.trim();
    if (!nick) return alert("Введите ник");

    const snap = await get(ref(db, "users/" + nick));
    if (!snap.exists()) {
      document.getElementById("userStats").innerHTML = "<p>Пользователь не найден</p>";
      return;
    }

    const u = snap.val();
    document.getElementById("userStats").innerHTML = `
      <p><b>Ник:</b> ${nick}</p>
      <p><b>Уровень:</b> ${u.level ?? "-"}</p>
      <p><b>Роль:</b> ${u.role ?? "-"}</p>
      <p><b>Сайт:</b> ${u.site ?? "-"}</p>
      <p><b>Испытательный срок:</b> ${u.isTrial ? "✅" : "❌"}</p>
      <p><b>Доступ к админке:</b> ${u.isAdmin ? "✅" : "❌"}</p>
    `;
  };
</script>
</body>
</html>
