<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Главная | SCP Foundation</title>
  <style>
    body {
      background:#0d0d0d;
      color:#eee;
      font-family:Segoe UI, Arial, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      margin:0;
    }
    .box {
      width:340px; /* сделал поуже */
      background:#1a1a1a;
      border-radius:14px;
      padding:22px;
      box-shadow:0 8px 24px rgba(0,0,0,.45);
    }
    h2 {
      margin:0 0 14px;
      font-weight:600;
    }
    p {
      margin:6px 0;
    }
    select, button {
      width:100%;
      padding:10px;
      margin-top:10px;
      border-radius:8px;
      border:0;
      font-size:14px;
    }
    select {
      background:#111;
      color:#eee;
    }
    button {
      background:#c62828;
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }
    button:hover {
      background:#e53935;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>SCP Foundation — Панель</h2>
    <div id="user-info"></div>
    <button onclick="logout()">Выйти</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA7mvVHeOg48A8HZknsdidnZlKQV6BJLIo",
      authDomain: "scp-foundation-45b20.firebaseapp.com",
      databaseURL: "https://scp-foundation-45b20-default-rtdb.firebaseio.com/",
      projectId: "scp-foundation-45b20",
      storageBucket: "scp-foundation-45b20.appspot.com",
      messagingSenderId: "383272466518",
      appId: "1:383272466518:web:3225b8911a56c9d769e3f7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Проверяем вход
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) {
      window.location.href = "index.html";
    }

    // Загружаем инфу о пользователе
    const snap = await get(ref(db, "users/" + user.nick));
    if (!snap.exists()) {
      window.location.href = "index.html";
    }
    const fullUser = snap.val();

    const container = document.getElementById("user-info");
    container.innerHTML = `
      <p><b>Ник:</b> ${user.nick}</p>
      <p><b>Уровень:</b> ${fullUser.level}</p>
      <p><b>Роль:</b> ${fullUser.role}</p>
      <p><b>Site:</b> ${fullUser.site || "Не назначен"}</p>
    `;

    // Если уровень > 3, разрешаем менять Site
    if (fullUser.level > 3) {
      const select = document.createElement("select");
      ["Site-17", "Site-82", "Site-19", "Site-12"].forEach(s => {
        const opt = document.createElement("option");
        opt.value = s; opt.textContent = s;
        if (fullUser.site === s) opt.selected = true;
        select.appendChild(opt);
      });

      const btn = document.createElement("button");
      btn.textContent = "Изменить сайт";
      btn.onclick = async () => {
        await update(ref(db, "users/" + user.nick), { site: select.value });
        alert("Сайт изменён на " + select.value);
        location.reload();
      };

      container.appendChild(select);
      container.appendChild(btn);
    }

    // Выход
    window.logout = () => {
      localStorage.removeItem("user");
      window.location.href = "index.html";
    };
  </script>
</body>
</html>
